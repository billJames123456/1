(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed0282cc"],{"1ec9":function(e,t,s){"use strict";s("e96b")},"36f7":function(e,t,s){},a97b:function(e,t,s){"use strict";s.r(t);s("14d9");var a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"main"}},[t("div",{style:e.displayTopMenu,attrs:{id:"album_top"}},[t("a",{staticClass:"album-icon",attrs:{title:"返回首页"},on:{click:function(t){return e.$router.push({name:"Album"})}}},[t("svg-icon",{attrs:{"icon-file-name":"home"}})],1),t("span",[e._v(e._s(e.currentAlbumName))])]),t("div",{style:e.displayCheckedMenu,attrs:{id:"albumCheck_menu"}},[t("div",{staticClass:"check_menu_item"},[t("div"),t("div",{staticClass:"check_menu_txt"},[t("a",{staticStyle:{"vertical-align":"middle","margin-right":"1.5em"},on:{click:function(t){return e.handleCheckAllChange(!1)}}},[t("svg-icon",{attrs:{"icon-file-name":"chacha"}})],1),e._v("已选择"+e._s(e.checkedCount)+"张图片")])]),t("div",{staticClass:"check_menu_feature"},[t("a",{attrs:{title:"全选图片"},on:{click:function(t){return e.handleCheckAllChange(!e.checkedStatus)}}},[t("svg-icon",{attrs:{"icon-file-name":"all"}})],1),t("a",{attrs:{title:"移除相册"},on:{click:function(t){return e.removeImage()}}},[t("svg-icon",{attrs:{"icon-file-name":"remove"}})],1),t("a",{attrs:{title:"下载图片"},on:{click:function(t){return e.downloadImage()}}},[t("svg-icon",{attrs:{"icon-file-name":"download"}})],1),t("a",{attrs:{title:"修改封面"},on:{click:function(t){return e.setAlbumCover()}}},[t("svg-icon",{attrs:{"icon-file-name":"set"}})],1)])]),t("el-divider"),t("div",{style:e.empty1,attrs:{id:"album-content"}},[t("div",{attrs:{id:"album-image-content"}},e._l(e.images,(function(s,a){return t("div",{key:a,staticClass:"album-image-group"},[t("div",{staticClass:"album-image-time"},[t("el-checkbox",{staticClass:"time-select",style:e.displayCheckedMenu,on:{change:function(t){return e.handleCheckPartChange(a,e.checkedPart)}}}),t("span",{staticClass:"time-txt"},[e._v(" "+e._s(s.time))])],1),e._l(s.image,(function(s,i){return t("div",{key:i,staticClass:"image-item",style:e.reactiveImage},[t("el-checkbox-group",{staticClass:"check-box",style:e.displayCheckedMenu,on:{change:e.handleCheckedImgChange},model:{value:e.checkedImgIndex,callback:function(t){e.checkedImgIndex=t},expression:"checkedImgIndex"}},[t("el-checkbox",{attrs:{label:a+","+i}})],1),t("el-image",{staticClass:"image",attrs:{src:e.serveUrL+s.compressUrL,"preview-src-list":e.getSrcList(a,i),lazy:""}},[t("div",{staticClass:"image-slot",staticStyle:{"margin-top":"3em"},attrs:{slot:"placeholder"},slot:"placeholder"},[t("svg-icon",{staticStyle:{"vertical-align":"-5px"},attrs:{"icon-file-name":"loading"}}),e._v("加载中 ")],1)])],1)}))],2)})),0)]),t("div",{style:e.empty2},[t("el-empty",{attrs:{"image-size":200,description:"暂无图片"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push({name:"upload"})}}},[e._v("去上传")])],1)],1)],1)},i=[],n={name:"InsideAlbum",data(){return{currentAlbumId:0,currentAlbumName:"",token:"",isRouterAlive:!0,serveUrL:this.$serveUrL,images:[{time:"2021年8月31日星期一",image:[{imageId:"",compressUrL:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg",imageName:""},{imageId:"",compressUrL:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg",imageName:""}]}],previewImageUrL:[""],reactiveImage:{},checkAll:!1,checkedImgIndex:[],checkedImgId:[],isIndeterminate:!1,checkedStatus:!1,checkedPart:!0,checkedCount:0,displayTopMenu:"true",displayCheckedMenu:"",empty1:"display:block",empty2:"display:none",dialogFormVisible:!1,form:{name:"",title:"",content:"",delivery:!1,type:[],resource:"",desc:""},formLabelWidth:"100px"}},created(){},mounted(){this.currentAlbumId=this.$route.query.albumId,this.currentAlbumName=this.$route.query.albumName;var e=this.$cookie.getCookie();"token"!=e[0]?(this.$message({message:"登录已过期!",type:"error"}),this.$router.push({name:"login"})):this.token=e[1],this.selectAllImage()},methods:{selectAllImage(){var e=this;const t=new FormData;t.append("token",this.token),t.append("albumId",this.currentAlbumId),this.axios({url:this.$serveUrL+"/album/selectAllImage",method:"post",data:t}).then((function(t){if("success"==t.data.status){e.images=t.data.data.images,e.previewImageUrL=t.data.data.previewImageUrL;for(var s=0;s<e.previewImageUrL.length;s++)e.previewImageUrL[s]=e.serveUrL+e.previewImageUrL[s];e.isRouterAlive=!e.isRouterAlive,e.images.length<1?(e.empty1="display:none",e.empty2="display:block"):(e.empty1="display:block",e.empty2="display:none")}}))},setAlbumCover(){this.handleCheckIndexToId(),console.log(this.checkedImgId[0]),this.checkedImgIndex.length>1?this.$message({message:"您只能选择一张图片作为相册封面",type:"warning"}):this.$confirm("是否将该图片设置为相册封面?","设置相册封面",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e=this;console.log(this.checkedImgId);const t=new FormData;t.append("token",this.token),t.append("albumId",this.currentAlbumId),t.append("imageId",this.checkedImgId[0]),this.axios({url:this.$serveUrL+"/album/setAlbumCover",method:"post",data:t}).then((function(t){"success"==t.data.status&&(e.$message({message:"相册封面设置成功！",type:"success"}),e.handleCheckAllChange(!1),e.selectAllImage())}))})},removeImage(){this.$confirm("此操作将移除相册集, 是否继续?","移除相册",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.handleCheckIndexToId();var e=this;console.log(this.checkedImgId);const t=new FormData;t.append("token",this.token),t.append("albumId",this.currentAlbumId),t.append("imageId",this.checkedImgId),this.axios({url:this.$serveUrL+"/album/removeImageFromAlbum",method:"post",data:t}).then((function(t){"success"==t.data.status&&(e.$message({message:"图片移除成功！",type:"success"}),e.handleCheckAllChange(!1),e.selectAllImage())}))})},downloadImage(){var e=this.checkedImgIndex,t=e[0].split(","),s=0;for(let l=0;l<t[0];l++)for(let e=0;e<this.images[l].image.length;e++)s++;s+=parseInt(t[1]);for(let l=0;l<e.length;l++){t=e[l].split(",");var a=this.previewImageUrL[s+l],i=this.images[t[0]].image[t[1]].imageName;this.downloadPicture(a,i)}this.handleCheckIndexToId();var n=this;const c=new FormData;c.append("token",this.token),c.append("number",this.checkedImgId.length),this.axios({url:this.$serveUrL+"/record/recordDownload",method:"post",data:c}).then((function(e){"success"==e.data.status&&(n.$message({message:"图片下载成功！",type:"success"}),n.dialogTableVisible=!1)}))},downloadPicture(e,t){fetch(e).then(e=>{e.blob().then(e=>{const s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=t,a.click(),window.URL.revokeObjectURL(s)})})},getSrcList(e,t){for(var s=0,a=0;a<e;a++)for(var i=0;i<this.images[a].image.length;i++)s++;return this.previewImageUrL.slice(s+t).concat(this.previewImageUrL.slice(0,s+t))},SwitchDisplay(e){e>0?"display:none;"==this.displayTopMenu&&""!=this.displayTopMenu||(this.displayCheckedMenu="display:block;",this.displayTopMenu="display:none;"):(this.displayCheckedMenu="",this.displayTopMenu="")},handleCheckPartChange(e,t){if(console.log(e,t),t){let t=this.images[e].image.length;console.log(t),this.checkedCount=t,this.checkedImgIndex=new Array(t);for(var s=0;s<t;s++)this.checkedImgIndex[s]=e+","+s}else this.checkedImgIndex=[],this.checkedCount=0;this.isIndeterminate=!1,this.checkedPart=!this.checkedPart,this.SwitchDisplay(this.checkedCount)},handleCheckAllChange(e){if(e){let e=this.images.length;for(var t=0,s=0;s<e;s++)for(var a=0;a<this.images[s].image.length;a++)t++;for(this.checkedCount=t,this.checkedImgIndex=new Array(t),t=0,s=0;s<e;s++)for(a=0;a<this.images[s].image.length;a++)this.checkedImgIndex[t++]=s+","+a}else this.checkedImgIndex=[],this.checkedCount=0;this.isIndeterminate=!1,this.checkedStatus=e,this.SwitchDisplay(this.checkedCount)},handleCheckIndexToId(){let e=this.checkedImgIndex.length,t=[];this.checkedImgId=new Array(e);for(let s=0;s<e;s++){let e=this.checkedImgIndex[s].split(",");t.push(this.images[e[0]].image[e[1]].imageId),console.log(t)}this.checkedImgId=t},handleCheckedImgChange(e){this.checkedImgIndex.sort(),this.checkedCount=e.length,this.SwitchDisplay(this.checkedCount),this.checkAll=this.checkedCount===this.images.length,this.isIndeterminate=this.checkedCount>0&&this.checkedCount<this.images.length}}},c=n,l=(s("b986"),s("1ec9"),s("2877")),h=Object(l["a"])(c,a,i,!1,null,"78d2ab2d",null);t["default"]=h.exports},b986:function(e,t,s){"use strict";s("36f7")},e96b:function(e,t,s){}}]);
//# sourceMappingURL=chunk-ed0282cc.397dafb3.js.map